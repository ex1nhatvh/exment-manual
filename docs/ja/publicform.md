# 公開フォーム設定
ログインしなくても一般ユーザーがデータを入力できる、公開フォームを設定することができます。  
  
通常の[データフォーム画面](/ja/data_form.md)は、Exmentの管理ページにID・パスワードを入力してログインする必要がありますが、公開フォームでは、ID・パスワードによるログインを行う必要なく、ユーザーにデータを入力させることができます。  
これにより、アンケートや問い合わせフォーム、申請フォームなどを作成し、URLを共有して、公開することが出来ます。  

## 公開フォーム設定の仕様について

<span class="red bold">公開フォーム設定より入力したデータは、公開フォーム設定を登録したユーザーが、作成ユーザー・更新ユーザーとして登録されます。</span>  
また、データ入力画面では、動的に他テーブルの選択肢を取得したり検索したりすることがありますが、その際の役割・権限も、公開フォーム設定を登録したユーザーとして扱います。  

そのため、システム管理者が公開フォームを登録することは、あまり推奨しません。  
後述の「<a href="#/ja/publicform?id=role_user">公開フォーム設定を行うユーザー・役割グループ設定</a>」の手順で、ユーザー・役割グループを設定することをオススメします。  


## 設定の流れ
以下の流れで、公開フォームを設定します。

1. システム設定画面で、公開フォーム設定を有効にします。

2. [カスタムフォーム設定](/ja/form)を行い、フォームに表示する項目・見出しなどの情報を設定します。

3. 公開フォーム設定を行うユーザー・役割グループを設定します。

4. 本ページの公開フォーム設定を行い、公開するフォームの選択、色、Googleアナリティクスなどの情報を設定します。

5. URLが発行されるので、公開します。

## 設定手順

### 1. システム設定画面
- [システム設定画面](/ja/system_setting)の「STEP2 詳細設定」に遷移し、「公開フォームを使用する」をYESにします。  
※既定ではNOになっています。これは、公開フォームを使用したい環境でのみ、公開フォームを使用できるようにするためです。  

TODO：システム設定画像

- Google reCAPTCHAを使用したい場合には、「Google reCAPTCHA」の項目を、V2もしくはV3に設定してください。  
選択後、Google reCAPTCHAのサイトキーとシークレットキー項目が表示されるので、[Google reCAPTCHAの管理ページ](http://www.google.com/recaptcha/admin)よりコピーした値を設定してください。  
※設定後、各公開フォーム設定画面で、Google reCAPTCHAを使用するかどうかを選択します。

TODO：システム設定画像


### 2. カスタムフォーム設定
- [カスタムフォーム設定](/ja/form)を行い、フォームに表示する項目・見出しなどの情報を設定します。この手順は、基本的に、通常のフォーム設定と同様です。


<h3 id="role_user"><a href="#/ja/publicform#role_user" data-id="role_user" class="anchor"><span>3. 公開フォーム設定を行うユーザー・役割グループ設定</span></a></h3>
公開フォーム設定を行うユーザー・役割グループを設定します。  
公開フォームから登録されたデータは、このユーザーで登録・更新したものとして扱います。

- [役割グループ設定](/ja/role_group)を新規作成します。
    - 「公開フォーム管理」権限を追加します。
	- 公開フォームを設定したいテーブルに対し、編集権限を追加します。
    - ならびに、その公開フォームでアクセスさせるテーブルの、閲覧権限も追加します。  

- 例：「お問い合わせ」テーブルの公開フォームを設定予定で、お問い合わせテーブルでは、すべての「製品」「カテゴリ」テーブルへの参照を行っている場合：  
    - 「お問い合わせ」テーブルに「公開フォーム管理」「担当者データの編集」権限
    - 「製品」「カテゴリ」テーブルに「すべてのデータの閲覧」権限

TODO:権限画面画像

- 公開フォームを管理するユーザーを追加します。
    - 役割グループは、上記で作成した役割グループを選択します。

- 上記で作成したユーザーでログインを行い、公開フォーム設定画面を表示し、公開フォームを登録してください。


### 4. 公開フォーム設定

- カスタムテーブル一覧で、設定を行いたいテーブルにチェックを1つ入れ、右上の「テーブル詳細設定」をクリックします。  
![カスタムフォーム画面](img/form/form_grid3.png)
- もしくは、メニューから設定を行いたいテーブルを選択した後、同様に右上の「テーブル詳細設定」をクリックします。  
※該当のテーブルをメニューに表示する設定があらかじめ必要です。  
![カスタムフォーム画面](img/form/form_grid4.png)
- 表示されたテーブル詳細設定の画面で、フォーム設定のアイコンをクリックします。
![カスタムフォーム画面](img/form/form_grid5.png)

- フォーム一覧画面の下部に、「公開フォーム設定」ボックスが追加されています。  
このボックス内の「＋新規」ボタンをクリックして、設定を行っていきます。

TODO：フォーム一覧画像

- 公開フォーム設定画面に遷移します。各項目を設定していきます。

#### 設定内容 - 基本設定
TODO：基本設定画像

- ##### 対象フォーム
公開フォームとして設定するフォームを選択します。上記の「2. カスタムフォーム設定」で作成したフォームを選択してください。

- ##### 公開フォーム表示名
一覧画面などで表示する表示名を入力してください。

- ##### 有効フラグ
この公開フォームを有効にする場合、YESに設定してください。  
※NOにすることで、この公開フォームが使用できなくなります。

- ##### 公開有効期限
フォームを公開する期限を設定する場合は、開始日時と終了日時を入力してください。  
※「開始日時」もしくは「終了日時」のみ入力することもできます。どちらも未入力の場合、常に有効になります。  
※公開有効期限外の場合、この公開フォームが使用できなくなります。


#### 設定内容 - デザイン設定
TODO：デザイン設定画像

ヘッダー、フォームレイアウト、フッターの色や文言、画像を設定します。  

- ##### フォーム表示レイアウト
フォームを、幅100%で表示するか、真ん中寄せで表示するかを選択します。  
入力内容によって、以下のように表示されます。

TODO：幅100%画像
TODO：真ん中寄せ画像



#### 設定内容 - 回答確認・完了設定
ユーザーがフォームに値を入力後の、回答確認画面・完了画面の設定を行います。

TODO：回答確認・完了設定画像

- ##### 回答確認を使用する
YESの場合、ユーザーの入力遷移が以下のような流れになります。

```
入力画面 → 確認画面 → 完了画面(データ登録)
```

※NOの場合、ユーザーの入力遷移が以下のような流れになります。

```
入力画面 → 完了画面(データ登録)
```

- ##### 確認タイトル
回答確認画面の確認タイトルの文言を入力してください。

- ##### 確認テキスト
確認画面のページ上部に表示するテキスト・HTMLを入力してください。  
※[パラメータ](/ja/params)を入力できます。また、スクリプトは実行できません。



- ##### 完了タイトル
完了画面のタイトルの文言を入力してください。

- ##### 完了テキスト
完了画面のページ上部に表示するテキスト・HTMLを入力してください。  
※[パラメータ](/ja/params)を入力できます。また、スクリプトは実行できません。

- ##### 完了リンク先URL
完了画面に、リンクを表示することができます。入力後に別画面に遷移させたい場合に、入力後のURLを入力してください。  
※「完了リンク先テキスト」も入力していた場合に有効になります。

- ##### 完了リンク先テキスト
完了画面に、リンクを表示することができます。入力後に別画面に遷移させたい場合に、リンクとして画面に表示する文言を入力してください。  
※「完了リンク先URL」も入力していた場合に有効になります。




#### 設定内容 - エラー設定
エラー設定が発生した場合の制御を行います。

TODO：エラー設定画像


- ##### エラータイトル
エラー画面のタイトルの文言を入力してください。

- ##### エラーテキスト
エラー画面のページ上部に表示するテキスト・HTMLを入力してください。  

- ##### エラーリンク先URL
エラー画面に、リンクを表示することができます。入力後に別画面に遷移させたい場合に、入力後のURLを入力してください。  
※「エラーリンク先テキスト」も入力していた場合に有効になります。

- ##### エラーリンク先テキスト
エラー画面に、リンクを表示することができます。入力後に別画面に遷移させたい場合に、リンクとして画面に表示する文言を入力してください。  
※「エラーリンク先URL」も入力していた場合に有効になります。

- ##### エラー通知を行う
YESの場合、エラーが発生した場合に、管理者に通知を行うことができます。



#### 設定内容 - オプション設定
その他のオプション設定を行います。

TODO：オプション設定画像

- ##### Googleアナリティクス
フォームにGoogleアナリティクスを設定する場合、「UA-」もしくは「G-」から始まる、Google Analyticsのタグを入力してください。

- ##### Google reCAPTCHAを使用する
Google reCAPTCHAを使用する場合、YESにしてください。  
※システム設定画面で、Google reCaptchaのキーを入力していた場合のみ、有効になります。


#### プレビュー
- 設定している内容を元に、公開フォームのプレビューを表示することができます。※データを保存していなくてもプレビュー可能です。  

- 画面右上の「プレビュー」ボタンをクリックすることで、別ウィンドウで公開フォームのプレビュー画面が表示されます。  
※javascriptにより、別ウィンドウ表示を実施します。ブラウザ設定によって、ポップアップがブロックされる場合があります。その際は、ブロックを解除し、再度ボタンをクリックしてください。

TODO：プレビュー画像  


#### 保存後、URLなど表示
- 公開フォームを保存することで、公開フォームのURLが表示されます。  
このURLをコピーして、ユーザーに配布などを行ってください。  
※項目をクリックすることで、URLをコピーすることができます。  

TODO：URL画像  



### 5. 公開フォーム使用
- 上記でコピーしたURLにアクセスすることで、公開フォームが表示されます。  
TODO：公開フォーム  

- 公開フォーム設定の「有効フラグ」がNOの場合、有効期間外の場合、URLに誤りがある場合には、以下のような表示になります。  
TODO：エラーページ  