# 大量データ一括投入
Exmentのカスタムテーブルにcsvファイルとして用意した大量データ（1000件以上）を一括投入します。  

## データの準備
最初にインポート用のcsvファイルを作成します。形式は以下のとおりです。  
- 1行目：カスタムテーブルの列名  
- 2行目以降～：投入するデータ  

※ファイル名は<strong>「カスタムテーブルの名前.csv」</strong>です。1つのテーブルに投入するデータが複数のファイルに分かれる場合は<strong>「カスタムテーブルの名前.連番.csv」</strong>(例：client.01.csv)のように連番を振ってください。   

※取込み可能なcsvファイルの文字コードは<strong>UTF-8</strong>です。  
EXCELでファイルを作成した場合、デフォルトの文字コードはシフトJISになります。必ず事前にテキストエディタ等で文字コード変換をかけてください。  

### カスタムテーブルの列名として使用できる値
| 項目 | 説明 |
| ---- | ---- |
| id | 主キー(数値) |
| parent_type | 親テーブルの名前 |
| parent_id | 紐づいている親データのID |
| deleted_at | データの削除日時 |
| deleted_user_id | データの削除したユーザーID |
| value.(カスタム列の列名) | カスタム列設定で登録した列名です。必ず先頭にvalue.をつけてください |

※特に理由がある場合を除き、csvファイルに設定するのはカスタム列のみにしてください。（その他の項目は自動的に設定されます）  
<strong>
通常のインポートと異なり、既存のデータと同じidを指定しても更新は行われません。  
</strong>

#### サンプルファイル（client.csv）
- 顧客テーブル（client）にデータを投入するサンプルです。顧客コード(client_code)と顧客名(client_name)、3件目のデータに削除日時(deleted_at)と削除ユーザーID(deleted_user_id)を設定しています。  

~~~
value.client_code,value.client_name,deleted_at,deleted_user_id
CUST001,テスト顧客名００１,,
CUST002,テスト顧客名００２,,
CUST003,テスト顧客名００３,2019/3/20,2
CUST004,テスト顧客名００４,,
CUST005,テスト顧客名００５,,
CUST006,テスト顧客名００６,,
CUST007,テスト顧客名００７,,
CUST008,テスト顧客名００８,,
CUST009,テスト顧客名００９,,
~~~

## 操作方法

1. サーバーの以下のパスに作業用のフォルダを作成します。フォルダ名は今回の作業の内容がわかるものや日付等がおすすめです。  

~~~
(プロジェクトのルートディレクトリ)/storage/app/bulkinsert
~~~

2. 作成したcsvファイル（複数可）を上記のフォルダに配置します。

#### フォルダの配置例
![一括投入用の作業フォルダ](img/bulkinsert/folder1.png)  

3. コマンドラインで、以下のコマンドを実行します。
~~~
php artisan exment:bulkinsert {フォルダ名}
~~~

#### コマンド実行例
![バックアップ画面](img/bulkinsert/cmd1.png)  

### 注意点
- 作成したcsvやデータの内容に不備がある場合でも細かなエラーチェックは実行されません。これは大量データ投入のためにパフォーマンスを優先しているためです。ファイル作成時には入念なチェックを行い、問題が発生した時はデータの一部を画面からのインポートで投入するなどしてみてください。

